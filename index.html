<canvas></canvas>
<div id="output" style="font-size: 10px; font-family: monospace;"></div>
<script>
    const canvas = document.querySelector('canvas');
    const ctx = canvas.getContext('2d');
    const densityString = '$@B%8&WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/\|()1{}[]?-_+~<>i!lI;:,"^`\'.';
    const inverter = false;
    const colunas = 80;

    const renderOutut = (pixels) => {
        const output = document.querySelector('#output');

        let out = '';
        for (let i = 0; i < pixels.length; i = i + 4) {
            if (i > 0 && i % (canvas.width * 4) == 0)
                out += `<br>`

            const r = pixels[i]
            const g = pixels[i + 1]
            const b = pixels[i + 2]
            const m = (r + g + b) / 3;

            let index = Math.floor(m * (densityString.length - 1) / 255);
            if (inverter)
                index = Math.abs((densityString.length - 1) - index)
            const char = densityString[index]
            out += char;
        }
        output.innerHTML = out;
    }

    const img = new Image();
    img.onload = () => {
        // const height = img.height;
        // const width = img.width;

        const height = img.height * colunas / 2 / img.width
        const width = colunas

        canvas.height = height;
        canvas.width = width;
        ctx.drawImage(img, 0, 0, width, height)
        renderOutut(ctx.getImageData(0, 0, width, height).data)
    }
    // img.src = 'balao.webp';
    img.src = '004.png';

</script>